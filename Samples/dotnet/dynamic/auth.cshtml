@using PayJS_Samples.Misc
@using Newtonsoft.Json;
@{
    string MerchantId = "417227771521";
    string MerchantKey = "I5T2R2K6V1Q3";
    string RequestId = "Invoice" + (new Random()).Next(100).ToString();
    string Amount = HttpContext.Current.Request.QueryString["amount"];
    var NonceTuple = Shared.GetNonce();
    string Nonce = NonceTuple.Item2;
    string PostbackUrl = "http://www.example.com";
    string RequestType = "payment";
    string Environment = Shared.Environment;

    var request = new
    {
        merchantId = MerchantId,
        merchantKey = MerchantKey,
        requestType = RequestType,
        requestId = RequestId,
        postbackUrl = PostbackUrl,
        nonce = Nonce,
        amount = Amount,
        environment = Environment,
        preAuth = false
    };

    string jsonReq = JsonConvert.SerializeObject(request);

    string AuthKey = Shared.GetAuthKey(jsonReq, Shared.DeveloperKEY, NonceTuple);
    HttpContext.Current.Response.ContentType = "text/json";
}
{
    "authKey": "@AuthKey",
    "invoice": "@RequestId",
    "nonce": "@Nonce",
    "merch": "@MerchantId",
    "postback": "@PostbackUrl"
}
